package com.project.beef.controller;

import java.util.Map;

import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartFile;

import com.project.beef.service.CutService;

import lombok.RequiredArgsConstructor;

@Controller
@RequiredArgsConstructor
public class CutController {

    private final CutService cutService;

    @GetMapping("/cut/list")
    public String list(Model model) {
        model.addAttribute("list", cutService.getList());
        return "cut/list";
    }

    @PostMapping("/analyze")
    public ResponseEntity<?> analyzeCut(@RequestParam("file") MultipartFile file, HttpServletRequest request) {
        // 1. **[보안 필터 작동]** 요청 헤더의 JWT 토큰을 Spring Security가 먼저 검증합니다.
        //    -> 토큰이 유효하면 이 메소드에 진입합니다.

        // 2. **[실제 분석 로직]** (현재 미완성)
        //    - 여기에 분석 로직이 들어갈 것입니다.
        
        // 3. **[임시 응답 반환]**
        //    실제 분석 결과 대신 임시 Mock 데이터를 반환하도록 수정해야 합니다.

        // ************* 임시 Mock 데이터 *************
        CutDto mockResult = new CutDto();
        mockResult.setDetectedPart("등심");
        mockResult.setDetectedGrade("1++A");
        mockResult.setMarblingRatio(35);
        mockResult.setInsight("마블링이 매우 우수한 최고급 등심입니다.");
        
        return ResponseEntity.ok(mockResult);
        // *******************************************
    }
}
