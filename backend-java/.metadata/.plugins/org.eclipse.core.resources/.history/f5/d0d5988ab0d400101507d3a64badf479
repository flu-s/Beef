package com.project.beef.controller;

import org.springframework.http.ResponseEntity;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController; // â­ @RestControllerë¡œ ë³€ê²½

import org.springframework.web.multipart.MultipartFile;

import com.project.beef.dto.CutDto;
import com.project.beef.service.CutService;

import jakarta.servlet.http.HttpServletRequest;
import lombok.RequiredArgsConstructor;

// ğŸš¨ğŸš¨ ê°€ì¥ ì¤‘ìš”í•œ ìˆ˜ì •: /api/cut ê²½ë¡œ ë§¤í•‘ ì¶”ê°€ ğŸš¨ğŸš¨
@RestController // @Controller ëŒ€ì‹  ì‚¬ìš© (JSON/ê°ì²´ ì‘ë‹µì— ì í•©)
@RequestMapping("/api/cut") // í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ê²½ë¡œ(/api/cut/analyze)ì™€ ì¼ì¹˜í•˜ë„ë¡ ì„¤ì •
@RequiredArgsConstructor
public class CutController {

    private final CutService cutService;

    // ì´ ë©”ì„œë“œëŠ” ì´ì œ GET /api/cut/list ê²½ë¡œë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.
    // (ë§Œì•½ Thymeleaf/JSP ë·°ë¥¼ ì“´ë‹¤ë©´ @Controllerë¥¼ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ëŠ” JSON/API ì‚¬ìš© ê°€ì • í•˜ì— @RestController ì ìš©)
    @GetMapping("/list")
    public String list(Model model) {
        model.addAttribute("list", cutService.getList());
        // REST API í™˜ê²½ì´ë¯€ë¡œ, ë·°ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê³  ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë„ë¡ ë³€ê²½í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
        // í˜„ì¬ëŠ” ê¸°ì¡´ ì½”ë“œì˜ êµ¬ì¡°ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
        return "cut/list"; 
    }

    // ì´ ë©”ì„œë“œëŠ” ì´ì œ POST /api/cut/analyze ê²½ë¡œë¡œ ë§¤í•‘ë©ë‹ˆë‹¤. (404 í•´ê²°)
    @PostMapping("/analyze")
    public ResponseEntity<?> analyzeCut(@RequestParam("file") MultipartFile file, HttpServletRequest request) {
        // 1. JWT ê²€ì¦ ì„±ê³µ (ì´ ì»¨íŠ¸ë¡¤ëŸ¬ê¹Œì§€ ìš”ì²­ì´ ë„ë‹¬í–ˆë‹¤ëŠ” ì˜ë¯¸)

        // 2. ì„ì‹œ Mock ë°ì´í„° ë°˜í™˜
        CutDto mockResult = new CutDto(
            "success", // status í•„ë“œ
            "ë“±ì‹¬", 
            "1++A", 
            35, 
            "ë§ˆë¸”ë§ì´ ë§¤ìš° ìš°ìˆ˜í•œ ìµœê³ ê¸‰ ë“±ì‹¬ì…ë‹ˆë‹¤."
        );
        
        return ResponseEntity.ok(mockResult); // 200 OKì™€ í•¨ê»˜ Mock ë°ì´í„° ë°˜í™˜
    }
}